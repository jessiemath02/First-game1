<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jessie Math - 200ä»¥å…§çš„æ•¸</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary-color: #FFD700; --bg-color: #fff9eb; --accent-color: #ff6b6b; }
        * { box-sizing: border-box; font-family: 'Microsoft JhengHei', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg-color); color: #444; touch-action: manipulation; }

        /* Header Area */
        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 15px; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: sticky; top: 0; z-index: 100;
        }
        .hero-left { display: flex; align-items: center; }
        .logo-circle {
            width: 45px; height: 45px; background: var(--primary-color);
            border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 8px;
        }
        .logo-circle img { width: 35px; height: auto; }
        .brand-name { font-weight: 900; font-size: 1.1rem; color: #333; }

        .nav-right { display: flex; gap: 8px; }
        .nav-btn {
            text-decoration: none; color: #666; font-size: 0.75rem;
            display: flex; flex-direction: column; align-items: center; cursor: pointer;
        }

        /* Screens */
        .screen { display: none; padding: 20px; max-width: 500px; margin: auto; text-align: center; min-height: 85vh; }
        .active { display: block; animation: softFade 0.5s ease; }
        @keyframes softFade { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* UI Elements */
        .input-group { background: white; padding: 30px 20px; border-radius: 30px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        input[type="text"] {
            padding: 15px; width: 90%; font-size: 1.2rem; border-radius: 15px;
            border: 2px solid #ffe082; margin: 15px 0; outline: none; text-align: center; background: #fffdf7;
        }
        .btn-main {
            background: var(--primary-color); border: none; padding: 15px 45px;
            font-size: 1.5rem; border-radius: 50px; cursor: pointer;
            box-shadow: 0 6px 0 #d4b500; font-weight: bold; margin-top: 10px; transition: 0.1s;
        }
        .btn-main:active { transform: translateY(4px); box-shadow: 0 2px 0 #d4b500; }

        /* Levels */
        .grid { display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 20px; }
        .lvl-card {
            background: white; padding: 20px; border-radius: 20px; border: 2px solid #eee;
            cursor: pointer; display: flex; align-items: center; gap: 15px; text-align: left; transition: 0.2s;
        }
        .lvl-card:hover { border-color: var(--primary-color); background: #fffef0; transform: scale(1.02); }
        .lvl-icon { font-size: 2.2rem; background: #fff9db; padding: 10px; border-radius: 15px; }

        /* Game Area */
        .hud { display: flex; justify-content: space-between; padding: 12px; font-weight: bold; background: rgba(255,255,255,0.8); border-radius: 15px; margin-bottom: 20px; border: 1px solid #eee; }
        
        .q-box {
            background: white; padding: 20px; border-radius: 25px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.04); margin-bottom: 25px; min-height: 220px;
            display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer;
            border: 2px solid #ffe082; position: relative;
        }
        .speaker-btn {
            background: var(--primary-color); width: 60px; height: 60px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; color: white; margin-bottom: 15px;
            box-shadow: 0 4px 10px rgba(212, 181, 0, 0.4);
        }
        .q-text { font-size: 1.8rem; line-height: 1.5; color: #222; font-weight: bold; }
        
        .options { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .opt-btn {
            background: white; border: 2px solid #f0f0f0; padding: 20px 10px;
            font-size: 1.7rem; border-radius: 20px; font-weight: bold; color: #333; cursor: pointer;
            box-shadow: 0 4px 0 #eee;
        }
        .opt-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #eee; }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.95); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 1000;
        }
    </style>
</head>
<body>

    <header>
        <div class="hero-left">
            <div class="logo-circle"><img src="JESSIEMATH-Q.png" alt="J" onerror="this.src='https://via.placeholder.com/40'"></div>
            <div class="brand-name">Jessie Math</div>
        </div>
        <div class="nav-right">
            <a href="https://jessiemath0703-chu.github.io/website2/" class="nav-btn"><i class="fas fa-home"></i>é¦–é </a>
            <a href="https://jessiemath0703-chu.github.io/Game-Lobby/" class="nav-btn"><i class="fas fa-gamepad"></i>å¤§å»³</a>

            <!-- âœ… åªæ”¹é€™é¡†ï¼šæ”¹æˆæ˜ç¢ºæ‰“åˆ° index.html + éŒ¨é»ï¼Œç›´æ¥é€²å…¥ä½ æˆªåœ–é‚£å€‹ã€Œ200ä»¥å…§çš„æ•¸ã€å½ˆçª—é  -->
            <a href="https://jessiemath0703-chu.github.io/Game-Lobby/index.html#g2-u1" class="nav-btn">
                <i class="fas fa-undo"></i>äºŒå¹´ç´š200ä»¥å…§çš„æ•¸
            </a>
        </div>
    </header>

    <div id="screen-login" class="screen active">
        <div class="input-group">
            <h2>è¼¸å…¥åå­—é–‹å§‹æŒ‘æˆ°</h2>
            <input type="text" id="player-name" placeholder="é»é€™è£¡å¯«åå­—..." maxlength="8">
            <button class="btn-main" onclick="toLevelSelect()">é€²å…¥éŠæˆ²</button>
        </div>
    </div>

    <div id="screen-levels" class="screen">
        <h3>é¸æ“‡æŒ‘æˆ°é—œå¡</h3>
        <div class="grid">
            <div class="lvl-card" onclick="startGame(1)" onmouseenter="speak('ç¬¬ä¸€é—œï¼Œä¾†ç·´ç¿’æ•¸åˆ°å…©ç™¾å§')">
                <div class="lvl-icon">ğŸ”¢</div>
                <div><b>1-1 æ•¸åˆ° 200</b><br><small>æ•¸å­—æ¥é¾ç·´ç¿’</small></div>
            </div>
            <div class="lvl-card" onclick="startGame(2)" onmouseenter="speak('ç¬¬äºŒé—œï¼Œèªè­˜ç™¾ã€åã€ä¸€')">
                <div class="lvl-icon">ğŸ§±</div>
                <div><b>1-2 ç™¾ã€åã€ä¸€</b><br><small>èªè­˜ä½å€¼æ¦‚å¿µ</small></div>
            </div>
            <div class="lvl-card" onclick="startGame(3)" onmouseenter="speak('ç¬¬ä¸‰é—œï¼Œä½ æ˜¯ä»˜éŒ¢å¤§å¸«å—ï¼Ÿ')">
                <div class="lvl-icon">ğŸ’°</div>
                <div><b>1-3 ä»˜éŒ¢å¤§å¸«</b><br><small>éŒ¢å¹£é»æ•¸èˆ‡çµ„åˆ</small></div>
            </div>
            <div class="lvl-card" onclick="startGame(4)" onmouseenter="speak('ç¬¬å››é—œï¼Œæ¯”æ¯”çœ‹èª°æ¯”è¼ƒå¤§')">
                <div class="lvl-icon">âš–ï¸</div>
                <div><b>1-4 èª°æ¯”è¼ƒå¤§</b><br><small>æ•¸å­—å¤§å°æ¯”è¼ƒ</small></div>
            </div>
        </div>
    </div>

    <div id="screen-game" class="screen">
        <div class="hud">
            <span>ğŸ† <span id="score">0</span></span>
            <span id="combo-display" style="color: #ff922b;"></span>
            <span style="color: var(--accent-color);">â³ <span id="time">60</span></span>
        </div>
        
        <div class="q-box" id="q-area" onclick="repeatQuestion()">
            <div class="speaker-btn">
                <i class="fas fa-volume-up"></i>
            </div>
            <div id="q-text" class="q-text">æº–å‚™å¥½äº†å—ï¼Ÿ</div>
            <div style="font-size: 0.85rem; color: #999; margin-top: 10px;">é»ä¸€ä¸‹å°å–‡å­ï¼Œæˆ‘æœƒå”¸é¡Œç›®å–”ï¼</div>
        </div>

        <div class="options" id="options-container"></div>

        <div style="margin-top: 30px; display: flex; justify-content: center; gap: 15px;">
            <button onclick="pauseGame()">æš«åœ</button>
            <button onclick="resetGame()">é‡æ–°</button>
            <button onclick="backToMenu()">é¸å–®</button>
        </div>
    </div>

    <div id="pause-overlay" class="overlay">
        <h2>æš«åœä¸­</h2>
        <button class="btn-main" onclick="resumeGame()">ç¹¼çºŒéŠæˆ²</button>
    </div>

    <div id="screen-result" class="screen">
        <h2 id="res-msg">æŒ‘æˆ°å®Œæˆï¼</h2>
        <div style="font-size: 3rem; margin: 15px 0; color: #f08c00;" id="res-score">0</div>
        <div id="stars" style="font-size: 3rem; color: #FFD700; margin-bottom: 20px;"></div>
        <button class="btn-main" onclick="showScreen('screen-levels')">å†ç©ä¸€æ¬¡</button>
    </div>

    <script>
        let score = 0, timeLeft = 60, combo = 0, timer = null, isPaused = false;
        let currentLevel = 1, currentAns = null, lastSpeech = "";

        // æ•¸å­—è½‰ä¸­æ–‡å”¸æ³•
        function numberToChinese(num) {
            if (num === 0) return "é›¶";
            const units = ["", "å", "ç™¾"];
            const chars = ["é›¶", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­", "ä¸ƒ", "å…«", "ä¹"];
            let str = num.toString();
            let result = "";
            for (let i = 0; i < str.length; i++) {
                let n = parseInt(str[i]);
                let pos = str.length - i - 1;
                if (n !== 0) {
                    if (!(pos === 1 && n === 1 && str.length === 2)) result += chars[n];
                    result += units[pos];
                } else {
                    if (result !== "" && result[result.length-1] !== "é›¶" && pos !== 0) result += "é›¶";
                }
            }
            return result.replace(/é›¶$/, "");
        }

        // èªéŸ³æ’­æ”¾
        function speak(text) {
            if(!text) return;
            window.speechSynthesis.cancel(); 
            let processedText = text.toString().replace(/\d+/g, (m) => numberToChinese(parseInt(m)));
            const msg = new SpeechSynthesisUtterance(processedText);
            msg.lang = 'zh-TW';
            msg.rate = 0.9;  
            msg.pitch = 1.2; 
            window.speechSynthesis.speak(msg);
        }

        // é‡æ–°å”¸é¡Œç›® (å–‡å­æŒ‰éˆ•è§¸ç™¼)
        function repeatQuestion() { speak(lastSpeech); }

        function toLevelSelect() {
            if(!document.getElementById('player-name').value) {
                alert("è«‹å…ˆå¯«ä¸‹ä½ çš„åå­—å–”ï¼");
                return;
            }
            showScreen('screen-levels');
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function startGame(lvl) {
            currentLevel = lvl;
            score = 0; timeLeft = 60; combo = 0; isPaused = false;
            document.getElementById('score').innerText = "0";
            showScreen('screen-game');
            startTimer();
            nextQuestion();
        }

        function startTimer() {
            clearInterval(timer);
            timer = setInterval(() => {
                if(!isPaused) {
                    timeLeft--;
                    document.getElementById('time').innerText = timeLeft;
                    if(timeLeft <= 0) endGame();
                }
            }, 1000);
        }

        function nextQuestion() {
            const container = document.getElementById('options-container');
            container.innerHTML = "";
            let data = generateQuestion(currentLevel);
            currentAns = data.ans;
            document.getElementById('q-text').innerText = data.display;
            lastSpeech = data.speech;

            data.opts.forEach(o => {
                const b = document.createElement('button');
                b.className = 'opt-btn';
                b.innerText = o;
                b.onclick = () => checkAns(o);
                container.appendChild(b);
            });
        }

        function generateQuestion(lvl) {
            let display, speech, ans, opts = [];
            const r = (m, x) => Math.floor(Math.random() * (x - m + 1)) + m;

            if(lvl === 1) { // æ•¸åˆ° 200
                let start = r(100, 195);
                display = `${start}, ${start+1}, ( ? )`;
                speech = `æ•¸å­—æ¥é¾ï¼Œ${start}, ${start+1}, ä¸‹ä¸€å€‹æ•¸å­—æ˜¯å¤šå°‘ï¼Ÿ`;
                ans = start + 2;
            } else if(lvl === 2) { // ä½å€¼
                let h = 1, t = r(0, 9), o = r(0, 9);
                display = `${h}å€‹ç™¾, ${t}å€‹å, ${o}å€‹ä¸€`;
                speech = `${h}å€‹ç™¾, ${t}å€‹å, å’Œ ${o}å€‹ä¸€, åˆèµ·ä¾†æ˜¯å¤šå°‘ï¼Ÿ`;
                ans = h*100 + t*10 + o;
            } else if(lvl === 3) { // ä»˜éŒ¢
                let total = r(11, 19) * 10;
                display = `ä»˜ä»˜çœ‹ï¼š${total} å…ƒ`;
                let h = Math.floor(total/100), t = (total%100)/10;
                speech = `é€™è¦${total}å…ƒ, è«‹å•è¦ä»˜å¹¾å¼µä¸€ç™¾å’Œå¹¾å€‹åå…ƒï¼Ÿ`;
                ans = `${h}å¼µ100, ${t}å€‹10`;
                opts = [ans, `${h}å¼µ100, ${r(1,9)}å€‹10`].sort(() => Math.random()-0.5);
            } else { // æ¯”è¼ƒ
                let n1 = r(100, 199), n2 = r(100, 199);
                while(n1 === n2) n2 = r(100, 199);
                display = `${n1} å’Œ ${n2}`;
                speech = `${n1} å’Œ ${n2}, å“ªä¸€å€‹æ¯”è¼ƒå¤§ï¼Ÿ`;
                ans = Math.max(n1, n2);
            }

            if(opts.length === 0) {
                opts = [ans];
                while(opts.length < 4) {
                    let w = ans + r(-10, 10);
                    if(w > 0 && !opts.includes(w)) opts.push(w);
                }
            }
            return { display, speech, ans, opts: opts.sort(() => Math.random() - 0.5) };
        }

        function checkAns(p) {
            if(p == currentAns) {
                score += (10 + combo);
                combo++; timeLeft += 5;
                document.getElementById('combo-display').innerText = `é€£æ“Š ${combo}`;
                speak("ç­”å°äº†ï¼");
            } else {
                combo = 0; timeLeft -= 5;
                document.getElementById('combo-display').innerText = "";
                speak("å“å‘€ï¼Œç­”æ¡ˆæ˜¯" + currentAns);
            }
            document.getElementById('score').innerText = score;
            setTimeout(nextQuestion, 800);
        }

        function pauseGame() { isPaused = true; document.getElementById('pause-overlay').style.display = 'flex'; }
        function resumeGame() { isPaused = false; document.getElementById('pause-overlay').style.display = 'none'; }
        function resetGame() { startGame(currentLevel); }
        function backToMenu() { clearInterval(timer); showScreen('screen-levels'); }

        function endGame() {
            clearInterval(timer);
            showScreen('screen-result');
            document.getElementById('res-score').innerText = score;
            let s = score > 150 ? "â˜…â˜…â˜…" : (score > 70 ? "â˜…â˜…" : "â˜…");
            document.getElementById('stars').innerText = s;
            speak("æŒ‘æˆ°çµæŸå›‰ï¼ä½ å¾—åˆ°äº†" + score + "åˆ†ï¼");
        }
    </script>
</body>
</html>
